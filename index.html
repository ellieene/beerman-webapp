<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Beerman Заказы</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial; background: #f5f5f5; margin: 0; padding: 10px; }
    h1 { text-align: center; font-size: 24px; }
    h2 { margin-top: 20px; font-size: 20px; }
    .product { display: flex; justify-content: space-between; align-items: center; background: white; padding: 12px 10px; margin: 5px 0; border-radius: 8px; font-size: 18px; }
    .product span.name { flex: 1 1 auto; min-width: 120px; margin-right: 10px; word-break: break-word; }
    .btns { display: flex; align-items: center; gap: 10px; flex: 0 0 auto; }
    .btns button { width: 45px; height: 45px; font-size: 22px; border-radius: 8px; border: none; background: #007bff; color: white; }
    .btns span { min-width: 30px; text-align: center; font-size: 18px; display: inline-block; }
    .send-btn { display: block; width: 100%; padding: 15px 0; font-size: 20px; background: #28a745; color: white; border: none; border-radius: 8px; margin-top: 30px; }
  </style>
</head>
<body>
  <h1>🛒 Заказ продуктов</h1>
  <div id="catalog"></div>
  <button class="send-btn" onclick="sendOrder()">✅ Отправить заказ</button>

  <script>
    let order = {};
    let locked = {};

    function update(product, delta) {
      if (locked[product]) return;
      locked[product] = true;

      if (!(product in order)) order[product] = 0;
      let newValue = order[product] + delta;
      if (newValue < 0) newValue = 0;

      if (newValue !== order[product]) {
        order[product] = newValue;
        document.getElementById(product).innerText = order[product];
      }

      locked[product] = false;
    }

    function sendOrder() {
      let items = [];
      for (let p in order) if (order[p] > 0) items.push(`${p}: ${order[p]}`);
      if (items.length === 0) { alert("Корзина пуста!"); return; }

      Telegram.WebApp.sendData(JSON.stringify(order));
      Telegram.WebApp.close();
    }

    async function renderCatalog() {
      const response = await fetch('catalog.json');
      const catalog = await response.json();
      const container = document.getElementById("catalog");

      for (const category in catalog) {
        const h2 = document.createElement("h2");
        h2.textContent = category;
        container.appendChild(h2);

        catalog[category].forEach(product => {
          const div = document.createElement("div");
          div.className = "product";

          const nameSpan = document.createElement("span");
          nameSpan.className = "name";
          nameSpan.textContent = product.name;

          const btns = document.createElement("div");
          btns.className = "btns";

          const minus = document.createElement("button");
          minus.textContent = "-";
          minus.onclick = () => update(product.name, -1);

          const count = document.createElement("span");
          count.id = product.name;
          count.textContent = "0";

          const plus = document.createElement("button");
          plus.textContent = "+";
          plus.onclick = () => update(product.name, 1);

          btns.appendChild(minus);
          btns.appendChild(count);
          btns.appendChild(plus);

          div.appendChild(nameSpan);
          div.appendChild(btns);

          container.appendChild(div);
        });
      }
    }

    window.onload = renderCatalog;
  </script>
</body>
</html>