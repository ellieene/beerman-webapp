<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Beerman –ó–∞–∫–∞–∑—ã</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial; background: #f5f5f5; margin: 0; padding: 10px; }
    h1 { text-align: center; font-size: 24px; }
    h2 { margin-top: 20px; font-size: 20px; }
    .product { display: flex; justify-content: space-between; align-items: center; background: white; padding: 12px 10px; margin: 5px 0; border-radius: 8px; font-size: 18px; }
    .product span.name { flex: 1 1 auto; min-width: 120px; margin-right: 10px; word-break: break-word; }
    .btns { display: flex; align-items: center; gap: 10px; flex: 0 0 auto; }
    .btns button { width: 45px; height: 45px; font-size: 22px; border-radius: 8px; border: none; background: #007bff; color: white; }
    .btns span { min-width: 30px; text-align: center; font-size: 18px; display: inline-block; }
    .send-btn { display: block; width: 100%; padding: 15px 0; font-size: 20px; background: #28a745; color: white; border: none; border-radius: 8px; margin-top: 30px; }
    #admin-panel { display:none; margin-top:30px; padding:15px; background:#ffeeba; border-radius:8px; }
    #admin-panel input, #admin-panel select { padding:5px; margin-left:5px; }
    .remove-btn { margin-left:10px; background:#dc3545; }
  </style>
</head>
<body>
  <h1>üõí –ó–∞–∫–∞–∑ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</h1>
  <div id="catalog"></div>
  <button class="send-btn" onclick="sendOrder()">‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>

<!-- –ê–¥–º–∏–Ω—Å–∫–∞—è –ø–∞–Ω–µ–ª—å -->
<div id="admin-panel" style="display:none; margin-top:30px; padding:15px; background:#ffeeba; border-radius:8px;">
    <h2>‚öôÔ∏è –ê–¥–º–∏–Ω—Å–∫–∞—è –ø–∞–Ω–µ–ª—å</h2>
  
    <div style="margin-bottom:10px;">
      <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:
        <select id="admin-category"></select>
        <button onclick="addCategory()">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
      </label>
      <input type="text" id="new-category" placeholder="–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è">
    </div>
  
    <div style="margin-bottom:10px;">
      <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:
        <input type="text" id="admin-name" placeholder="–ú–æ–ª–æ–∫–æ">
      </label>
    </div>
  
    <div style="margin-bottom:10px;">
      <label>–ï–¥–∏–Ω–∏—Ü—ã:
        <select id="admin-unit">
          <option value="—à—Ç">—à—Ç</option>
          <option value="–∫–≥">–∫–≥</option>
          <option value="–ª">–ª</option>
        </select>
      </label>
    </div>
  
    <button onclick="addProduct()">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
  
    <h3>–¢–æ–≤–∞—Ä—ã</h3>
    <div id="admin-products"></div>
  </div>
  
  <script>
  let order = {};
  let catalogData = {};
  let locked = {};
  
  function update(product, delta) {
    if (locked[product]) return;
    locked[product] = true;
  
    if (!(product in order)) order[product] = 0;
    let newValue = order[product] + delta;
    if (newValue < 0) newValue = 0;
  
    if (newValue !== order[product]) {
      order[product] = newValue;
      document.getElementById(product).innerText = order[product];
    }
  
    locked[product] = false;
  }
  
  function sendOrder() {
    let items = [];
    for (let p in order) if (order[p] > 0) items.push(`${p}: ${order[p]}`);
    if (items.length === 0) { alert("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!"); return; }
  
    Telegram.WebApp.sendData(JSON.stringify(order));
    Telegram.WebApp.close();
  }
  
  async function renderCatalog() {
    const response = await fetch('catalog.json');
    catalogData = await response.json();
  
    const user = Telegram.WebApp.initDataUnsafe.user;
    const container = document.getElementById("catalog");
    const adminPanel = document.getElementById("admin-panel");
  
    if (user && user.username === "ellieen") {
      // –ê–¥–º–∏–Ω –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø–∞–Ω–µ–ª—å
      container.style.display = "none";
      document.querySelector(".send-btn").style.display = "none";
      adminPanel.style.display = "block";
  
      renderAdminCategories();
      renderAdminProducts();
    } else {
      // –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
      adminPanel.style.display = "none";
      container.style.display = "block";
      document.querySelector(".send-btn").style.display = "block";
  
      container.innerHTML = "";
      for (const category in catalogData) {
        const h2 = document.createElement("h2");
        h2.textContent = category;
        container.appendChild(h2);
  
        catalogData[category].forEach(product => {
          const div = document.createElement("div");
          div.className = "product";
  
          const nameSpan = document.createElement("span");
          nameSpan.className = "name";
          nameSpan.textContent = `${product.name} (${product.unit})`;
  
          const btns = document.createElement("div");
          btns.className = "btns";
  
          const minus = document.createElement("button");
          minus.textContent = "-";
          minus.onclick = () => update(product.name, -1);
  
          const count = document.createElement("span");
          count.id = product.name;
          count.textContent = "0";
  
          const plus = document.createElement("button");
          plus.textContent = "+";
          plus.onclick = () => update(product.name, 1);
  
          btns.appendChild(minus);
          btns.appendChild(count);
          btns.appendChild(plus);
  
          div.appendChild(nameSpan);
          div.appendChild(btns);
  
          container.appendChild(div);
        });
      }
    }
  }
  
  // --- –ê–¥–º–∏–Ω —Ñ—É–Ω–∫—Ü–∏–∏ ---
  function renderAdminCategories() {
    const catSelect = document.getElementById("admin-category");
    catSelect.innerHTML = "";
    for (const category in catalogData) {
      const opt = document.createElement("option");
      opt.value = category;
      opt.textContent = category;
      catSelect.appendChild(opt);
    }
  }
  
  function renderAdminProducts() {
    const div = document.getElementById("admin-products");
    div.innerHTML = "";
    for (const category in catalogData) {
      catalogData[category].forEach(product => {
        const pDiv = document.createElement("div");
        pDiv.textContent = `${category} ‚Üí ${product.name} (${product.unit}) `;
        const delBtn = document.createElement("button");
        delBtn.textContent = "‚ùå";
        delBtn.onclick = () => {
          catalogData[category] = catalogData[category].filter(p => p.name !== product.name);
          renderAdminProducts();
          renderAdminCategories();
        };
        pDiv.appendChild(delBtn);
        div.appendChild(pDiv);
      });
    }
  }
  
  function addCategory() {
    const name = document.getElementById("new-category").value.trim();
    if (!name) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏");
    if (!catalogData[name]) catalogData[name] = [];
    renderAdminCategories();
  }
  
  function addProduct() {
    const name = document.getElementById("admin-name").value.trim();
    const category = document.getElementById("admin-category").value;
    const unit = document.getElementById("admin-unit").value;
    if (!name || !category) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é");
  
    if (!catalogData[category]) catalogData[category] = [];
    catalogData[category].push({ name, unit });
  
    renderAdminProducts();
    renderAdminCategories();
  }
  
  // --- —Å—Ç–∞—Ä—Ç ---
  window.onload = renderCatalog;
  </script>
</body>
</html>